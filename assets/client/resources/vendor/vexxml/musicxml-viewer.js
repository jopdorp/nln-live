Vex.Flow.MusicXML.CanvasViewer=function(a,b){this.staffsystem_options={x:20,y:10,width:600};Vex.Merge(this.staffsystem_options,b);this.doc=a;this.staffSystem=null;this.displayWidth=800;this.displayHeight=180;this.zoom=0.8;this.canvas=null};
Vex.ML.CanvasViewer.prototype.getStaffSystem=function(){this.staffSystem=null;this.staffsystem_options.width=Math.floor(this.displayWidth/this.zoom-50);this.staffSystem=new Vex.ML.StaffSystem(this.doc,this.staffsystem_options);this.displayHeight=(this.staffSystem.getHeight()+20)*this.zoom;return this.staffSystem};
Vex.ML.CanvasViewer.prototype.getCanvas=function(){if(this.canvas)return this.canvas;this.canvas=document.createElement("canvas");if(window.devicePixelRatio>1){this.canvas.setAttribute("width",this.displayWidth*window.devicePixelRatio);this.canvas.setAttribute("height",this.displayHeight*window.devicePixelRatio);this.canvas.style.width=this.displayWidth+"px";this.canvas.style.height=this.displayHeight+"px";var a=this.zoom*window.devicePixelRatio;this.canvas.getContext("2d").scale(a,a)}else{this.canvas.setAttribute("width",
this.displayWidth);this.canvas.setAttribute("height",this.displayHeight);this.canvas.getContext("2d").scale(this.zoom,this.zoom)}return this.canvas};Vex.ML.CanvasViewer.prototype.drawInCanvas=function(){this.getStaffSystem();this.getCanvas();var a=this.canvas.getContext("2d");this.staffSystem.draw(a);this.staffSystem.drawContents(a)};Vex.Flow.MusicXML.Viewer=function(a,b){arguments.length>0&&this.init(a,b)};
Vex.ML.Viewer.prototype.init=function(a,b){this.element=a;this.doc=b;this.canvasViewers=[];this.displayWidth=800;this.zoom=window.devicePixelRatio>=2&&window.innerWidth<=480?0.5:window.devicePixelRatio>=2?0.6:0.8;this.layout()};Vex.ML.Viewer.prototype.getScale=function(){var a=window.devicePixelRatio||1;if(a>1)return a*this.zoom;return this.zoom};
Vex.ML.Viewer.prototype.addCanvasViewer=function(a,b){b=new Vex.ML.CanvasViewer(this.doc,b);b.zoom=this.zoom;b.displayWidth=a.width;b.drawInCanvas();this.element.appendChild(b.getCanvas());return b};
Vex.ML.Viewer.prototype.layout=function(){this.element.innerHTML="";var a=$(".vexml_viewer").width();console.warn(a);for(var b=0;b<this.doc.getPart(0).getNumberOfMeasures();){b=this.addCanvasViewer({width:a,height:180},{start_measure:b,x:20,y:10,width:Math.floor((a-40)/this.zoom)});this.canvasViewers.push(b);b=b.staffSystem.end_measure+1}};
